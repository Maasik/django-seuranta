{% extends "base.html" %}
{% load i18n %}

{% block title %}{{ competition.name }}{% endblock %}

{% block extra_heads %}
<style>
</style>
{% endblock %}

{% block content %}
<h2>{{ competition.name }}</h2>
<div id="countdown"></div>
{% endblock %}

{% block extra_scripts %}
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.5.1/moment.min.js"></script>
<script type="text/javascript" src="{{STATIC_URL}}seuranta/js/server_clock.min.js"></script>
<script>
$(function(){
    var race_info = {{competition.as_json|safe}},
        TIME_API_URL = '{% url 'seuranta.views.api' 'get_time' %}',
        clock = new ServerClock({time_api_url:TIME_API_URL});

    setInterval(function(){
        var MINUTE = 60, HOUR = 60*MINUTE, DAY = 24*HOUR, YEAR = 365.25*DAY,
            timeLeft = Math.round((Date.parse(race_info.start_date) - clock.now())/1e3),
            years = Math.floor(timeLeft/YEAR),
            days = Math.floor((timeLeft-years*YEAR)/DAY),
            hours = Math.floor((timeLeft-years*YEAR-days*DAY)/HOUR),
            minutes = Math.floor((timeLeft-years*YEAR-days*DAY-hours*HOUR)/MINUTE),
            seconds = Math.floor(timeLeft%60),
            text = (years!=0?(years+" year"+(years>1?"s ":" ")):"")+
                (days!=0?(days+" day"+(days==1?" ":"s ")):(years==0?"":"0 days "))+
                (hours!=0?(hours+" hour"+(hours==1?" ":"s ")):(years==0&&days==0?"":"0 hours "))+
                (minutes!=0?(minutes+" minute"+(minutes==1?" ":"s ")):(years==0&&days==0&&hours==0?"":"0 minutes "))+
                (seconds!=0?(seconds+" second"+(seconds==1?"":"s")):(years==0&&days==0&&hours==0&&minutes==0?"":"0 seconds"));

        if(timeLeft<=0){
            window.location.reload();
        }

        $("#countdown").html("<div style='text-align:center'><h2>Starts in "+text+".</h2></div>");
    }, 500);
});
</script>
{% endblock %}